//Generated by TurboLink CodeGenerator, do not edit!
#include "SSroGameserver/ConnectionService.h"
#include "SSroGameserver/ConnectionClient.h"
#include "ConnectionService_Private.h"
#include "ConnectionMarshaling.h"
#include "SGoogleApi/AnnotationsMarshaling.h"
#include "SSro/GlobalsMarshaling.h"
#include "TurboLinkGrpcManager_Private.h"
#include "TurboLinkGrpcUtilities.h"

UConnectionService::UConnectionService()
	: d(new UConnectionService::Private())
{
}

UConnectionService::~UConnectionService()
{
	delete d;
}

void UConnectionService::Connect()
{
	FString serviceEndPoint = UTurboLinkGrpcUtilities::GetTurboLinkGrpcConfig()->GetServiceEndPoint(TEXT("ConnectionService"));
	UE_LOG(LogTurboLink, Warning, TEXT("Connect to ConnectionService: '%s'"), *serviceEndPoint);

	if (d->Channel == nullptr) {
		d->Channel = TurboLinkManager->d->CreateServiceChannel(TCHAR_TO_UTF8(*serviceEndPoint), this);
	}
	if (d->Stub == nullptr) {
		d->Stub = sro::gameserver::ConnectionService::NewStub(d->Channel->RpcChannel);
	}

	grpc_connectivity_state currentChannelState = d->Channel->RpcChannel->GetState(true);
	if (OnServiceStateChanged.IsBound())
	{
		OnServiceStateChanged.Broadcast(UTurboLinkGrpcManager::Private::GrpcStateToServiceState(currentChannelState));
	}
}

EGrpcServiceState UConnectionService::GetServiceState() const
{
	if (d->Channel == nullptr) return EGrpcServiceState::NotCreate;

	auto rpcChannelState = d->Channel->RpcChannel->GetState(false);
	return UTurboLinkGrpcManager::Private::GrpcStateToServiceState(rpcChannelState);
}

UConnectionServiceClient* UConnectionService::MakeClient()
{
	auto client = UGrpcService::MakeClient<UConnectionServiceClient>();
	return client;
}

void UConnectionService::Shutdown()
{
	Super::Shutdown();
	d->Stub = nullptr;
	if (d->Channel != nullptr) {
		TurboLinkManager->d->RemoveServiceChannel(d->Channel, this);
		d->Channel = nullptr;
	}
}

void UConnectionService::CallConnectGameServer(const FGrpcSroTargetId& Request, FConnectGameServerResponseLambda ResponseLambda, TMap<FString, FString>& MetaData)
{
	if (InnerClient == nullptr)
	{
		InnerClient = MakeClient();
	}
	UConnectionServiceConnectGameServerLambdaWrapper* lambdaWrapper = NewObject<UConnectionServiceConnectGameServerLambdaWrapper>();
	lambdaWrapper->InnerClient = InnerClient;
	lambdaWrapper->ResponseLambda = ResponseLambda;
	lambdaWrapper->Handle = InnerClient->InitConnectGameServer();
	InnerClient->OnConnectGameServerResponse.AddUniqueDynamic(lambdaWrapper, &UConnectionServiceConnectGameServerLambdaWrapper::OnResponse);
	InnerClient->ConnectGameServer(lambdaWrapper->Handle, Request, MetaData);
}

void UConnectionService::CallVerifyConnect(const FGrpcSroGameserverVerifyConnectRequest& Request, FVerifyConnectResponseLambda ResponseLambda, TMap<FString, FString>& MetaData)
{
	if (InnerClient == nullptr)
	{
		InnerClient = MakeClient();
	}
	UConnectionServiceVerifyConnectLambdaWrapper* lambdaWrapper = NewObject<UConnectionServiceVerifyConnectLambdaWrapper>();
	lambdaWrapper->InnerClient = InnerClient;
	lambdaWrapper->ResponseLambda = ResponseLambda;
	lambdaWrapper->Handle = InnerClient->InitVerifyConnect();
	InnerClient->OnVerifyConnectResponse.AddUniqueDynamic(lambdaWrapper, &UConnectionServiceVerifyConnectLambdaWrapper::OnResponse);
	InnerClient->VerifyConnect(lambdaWrapper->Handle, Request, MetaData);
}

void UConnectionService::CallTransferPlayer(const FGrpcSroGameserverTransferPlayerRequest& Request, FTransferPlayerResponseLambda ResponseLambda, TMap<FString, FString>& MetaData)
{
	if (InnerClient == nullptr)
	{
		InnerClient = MakeClient();
	}
	UConnectionServiceTransferPlayerLambdaWrapper* lambdaWrapper = NewObject<UConnectionServiceTransferPlayerLambdaWrapper>();
	lambdaWrapper->InnerClient = InnerClient;
	lambdaWrapper->ResponseLambda = ResponseLambda;
	lambdaWrapper->Handle = InnerClient->InitTransferPlayer();
	InnerClient->OnTransferPlayerResponse.AddUniqueDynamic(lambdaWrapper, &UConnectionServiceTransferPlayerLambdaWrapper::OnResponse);
	InnerClient->TransferPlayer(lambdaWrapper->Handle, Request, MetaData);
}

void UConnectionService::CallIsCharacterPlaying(const FGrpcSroTargetId& Request, FIsCharacterPlayingResponseLambda ResponseLambda, TMap<FString, FString>& MetaData)
{
	if (InnerClient == nullptr)
	{
		InnerClient = MakeClient();
	}
	UConnectionServiceIsCharacterPlayingLambdaWrapper* lambdaWrapper = NewObject<UConnectionServiceIsCharacterPlayingLambdaWrapper>();
	lambdaWrapper->InnerClient = InnerClient;
	lambdaWrapper->ResponseLambda = ResponseLambda;
	lambdaWrapper->Handle = InnerClient->InitIsCharacterPlaying();
	InnerClient->OnIsCharacterPlayingResponse.AddUniqueDynamic(lambdaWrapper, &UConnectionServiceIsCharacterPlayingLambdaWrapper::OnResponse);
	InnerClient->IsCharacterPlaying(lambdaWrapper->Handle, Request, MetaData);
}

void UConnectionService::CallIsUserPlaying(const FGrpcSroTargetId& Request, FIsUserPlayingResponseLambda ResponseLambda, TMap<FString, FString>& MetaData)
{
	if (InnerClient == nullptr)
	{
		InnerClient = MakeClient();
	}
	UConnectionServiceIsUserPlayingLambdaWrapper* lambdaWrapper = NewObject<UConnectionServiceIsUserPlayingLambdaWrapper>();
	lambdaWrapper->InnerClient = InnerClient;
	lambdaWrapper->ResponseLambda = ResponseLambda;
	lambdaWrapper->Handle = InnerClient->InitIsUserPlaying();
	InnerClient->OnIsUserPlayingResponse.AddUniqueDynamic(lambdaWrapper, &UConnectionServiceIsUserPlayingLambdaWrapper::OnResponse);
	InnerClient->IsUserPlaying(lambdaWrapper->Handle, Request, MetaData);
}
